<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Restaurant Menu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body class="bg-gray-100 font-sans">

  <!-- Container -->
  <div class="max-w-screen-xl mx-auto p-4 sm:p-6">

    <!-- Restaurant Header -->
    <div class="text-center mb-6">
      <h1 id="restaurantName" class="text-3xl sm:text-4xl font-bold text-orange-600">Restaurant Name</h1>
      <p class="text-sm text-gray-500 flex items-center justify-center gap-2">
        <i class="fas fa-map-marker-alt"></i>
        <span id="locationText">Restaurant Location</span>
      </p>
    </div>

    <!-- Categories -->
    <div id="categories" class="flex flex-wrap gap-2 justify-center mb-6"></div>

    <!-- Menu Items Grid -->
    <div id="restaurantMenu" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <!-- Floating Cart Button -->
    <button id="cartCount" class="fixed bottom-5 right-5 bg-orange-500 text-white px-4 py-3 rounded-full shadow-lg text-xl flex items-center space-x-2 z-40">
      <i class="fas fa-shopping-cart"></i>
      <span id="cartCountText">0</span>
    </button>

    <!-- Cart Drawer -->
    <div id="cartDrawer" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
      <div class="bg-white w-full sm:w-3/4 md:w-1/2 lg:w-1/3 h-full fixed right-0 top-0 p-4 overflow-y-auto">
        <button id="closeCartBtn" class="text-gray-500 text-2xl mb-4">&times;</button>
        <h2 class="text-xl font-bold mb-4">Your Cart</h2>
        <div id="cartItems" class="space-y-4"></div>
        <div class="flex justify-between items-center mt-4 font-semibold">
          <span>Total:</span>
          <span id="totalAmount">0.00</span>
        </div>
        <button id="proceedBtn" class="mt-6 w-full bg-green-500 text-white py-2 rounded-lg">Proceed to Payment</button>
        <button id="clearCartBtn" class="mt-3 w-full bg-red-500 text-white py-2 rounded-lg">Clear Cart</button>
      </div>
    </div>

    <!-- Item Modal -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
      <div class="bg-white w-full sm:w-3/4 md:w-1/2 lg:w-1/3 max-h-full overflow-y-auto mx-auto mt-20 p-6 rounded-lg shadow-lg relative">
        <button id="closeModalBtn" class="text-gray-500 text-2xl absolute top-3 right-3">&times;</button>
        <h3 id="itemName" class="text-2xl font-semibold text-gray-800 mb-2"></h3>
        <p id="itemDescription" class="text-gray-600 mb-4"></p>
        <p id="itemPrice" class="text-orange-500 font-bold mb-4"></p>
        <input id="quantity" type="number" min="1" value="1" class="w-full border rounded-lg p-2 mb-4"/>
        <button id="addToCartBtn" class="bg-blue-500 text-white py-2 w-full rounded-lg">Add to Cart</button>
      </div>
    </div>

  </div>

  <!-- Firebase & Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAxBT0oESoL62oz_x_Z8cMtdENWZPx4tMI",
      authDomain: "pinotp-d7ef5.firebaseapp.com",
      databaseURL: "https://pinotp-d7ef5-default-rtdb.firebaseio.com",
      projectId: "pinotp-d7ef5",
      storageBucket: "pinotp-d7ef5.appspot.com",
      messagingSenderId: "708458917827",
      appId: "1:708458917827:web:8b8cc6de6176f936cf9776"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    const restaurantName = document.getElementById('restaurantName');
    const restaurantLocation = document.getElementById('locationText');
    const restaurantMenu = document.getElementById('restaurantMenu');
    const categoriesContainer = document.getElementById('categories');

    const urlParams = new URLSearchParams(window.location.search);
    const restaurantId = urlParams.get('restaurantId');
    let allMenuItems = [];

    onAuthStateChanged(auth, (user) => {
      if (user) {
        loadRestaurantData();
      }
    });

    function loadRestaurantData() {
      const restaurantRef = ref(db, `restaurants/${restaurantId}`);
      onValue(restaurantRef, (snapshot) => {
        const restaurant = snapshot.val();
        if (!restaurant) return;
        restaurantName.textContent = restaurant.name;
        restaurantLocation.textContent = restaurant.location || 'No location';
        allMenuItems = Object.entries(restaurant.menu || {});
        renderCategories(allMenuItems);
        renderMenuItems(allMenuItems);
      });
    }

    function renderCategories(menuItems) {
      categoriesContainer.innerHTML = '';
      const categories = new Set(menuItems.map(([_, item]) => item.category));

      const createButton = (label, iconHTML, isAll = false) => {
        const btn = document.createElement('button');
        btn.className = 'px-4 py-2 rounded-full bg-gray-200 text-sm text-gray-700 hover:bg-orange-500 hover:text-white transition flex items-center space-x-2';
        btn.innerHTML = iconHTML + label;
        btn.onclick = () => {
          document.querySelectorAll('#categories button').forEach(b => b.classList.remove('bg-orange-500', 'text-white'));
          btn.classList.add('bg-orange-500', 'text-white');
          renderMenuItems(isAll ? allMenuItems : allMenuItems.filter(([_, item]) => item.category === label));
        };
        categoriesContainer.appendChild(btn);
      };

      createButton('All', '<i class="fas fa-utensils"></i> ', true);

      categories.forEach(category => {
        let icon = '<i class="fas fa-utensils"></i>';
        if (category === 'Pizza') icon = '<i class="fas fa-pizza-slice"></i>';
        else if (category === 'Burgers') icon = '<i class="fas fa-hamburger"></i>';
        else if (category === 'Sushi') icon = '<i class="fas fa-fish"></i>';
        createButton(category, icon + ' ');
      });
    }

    function renderMenuItems(items) {
      restaurantMenu.innerHTML = '';
      items.forEach(([id, item]) => {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow-md overflow-hidden flex flex-col';
        card.innerHTML = `
          <img src="${item.image}" class="w-full h-40 object-cover" alt="${item.name}">
          <div class="p-4 flex-1 flex flex-col justify-between">
            <div>
              <h3 class="text-lg font-semibold text-gray-800">${item.name}</h3>
              <p class="text-gray-600 text-sm mt-1">${item.description}</p>
            </div>
            <div>
              <p class="text-orange-500 font-bold text-md mt-2">R${item.price.toFixed(2)}</p>
              <button class="mt-3 w-full bg-orange-500 text-white py-2 rounded-md" onclick="openItemModal('${id}')">View Details</button>
            </div>
          </div>
        `;
        restaurantMenu.appendChild(card);
      });
    }

    // Placeholder functions
    window.openItemModal = (itemId) => {
      const item = allMenuItems.find(([id]) => id === itemId)?.[1];
      if (!item) return;
      document.getElementById('itemName').textContent = item.name;
      document.getElementById('itemDescription').textContent = item.description;
      document.getElementById('itemPrice').textContent = 'R' + item.price.toFixed(2);
      document.getElementById('itemModal').classList.remove('hidden');
    };

    document.getElementById('closeModalBtn').onclick = () => {
      document.getElementById('itemModal').classList.add('hidden');
    };

    document.getElementById('closeCartBtn').onclick = () => {
      document.getElementById('cartDrawer').classList.add('hidden');
    };

    document.getElementById('cartCount').onclick = () => {
      document.getElementById('cartDrawer').classList.remove('hidden');
    };
  </script>
</body>
</html>
