<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order Status</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <div class="container mx-auto p-6">
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <h1 class="text-2xl font-bold text-center">Order Status</h1>
      <hr class="mt-4 mb-6"/>

      <div class="mt-8 bg-gray-100 p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold">Order Summary</h2>
        <p><strong>Order ID:</strong> <span id="orderId"></span></p>
        <p><strong>Total:</strong> R<span id="orderTotal"></span></p>
        <p><strong>Payment Method:</strong> <span id="orderPaymentMethod"></span></p>
        <p><strong>Address:</strong> <span id="orderAddress"></span></p>
        <p><strong>Phone:</strong> <span id="orderPhone"></span></p>
        <p><strong>Special Instructions:</strong> <span id="orderInstructions"></span></p>

        <h3 class="mt-6 font-semibold">Items:</h3>
        <ul id="orderItems" class="list-disc pl-5 mt-2">
          <!-- Order items will be dynamically added here -->
        </ul>
      </div>

      <div class="mt-8 bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold">Current Status</h2>
        <p id="orderStatus" class="mt-4 text-lg">Loading...</p>
      </div>

      <div class="mt-8 text-center">
        <button id="contactDriverBtn" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg hidden">
          Contact Driver
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAxBT0oESoL62oz_x_Z8cMtdENWZPx4tMI",
      authDomain: "pinotp-d7ef5.firebaseapp.com",
      databaseURL: "https://pinotp-d7ef5-default-rtdb.firebaseio.com",
      projectId: "pinotp-d7ef5",
      storageBucket: "pinotp-d7ef5.appspot.com",
      messagingSenderId: "708458917827",
      appId: "1:708458917827:web:8b8cc6de6176f936cf9776"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const urlParams = new URLSearchParams(window.location.search);
    const orderId = urlParams.get('orderId');
    const orderRef = ref(db, `orders/${orderId}`);

    const orderIdElement = document.getElementById('orderId');
    const orderTotalElement = document.getElementById('orderTotal');
    const orderPaymentMethodElement = document.getElementById('orderPaymentMethod');
    const orderItemsElement = document.getElementById('orderItems');
    const orderStatusElement = document.getElementById('orderStatus');
    const orderAddressElement = document.getElementById('orderAddress');
    const orderPhoneElement = document.getElementById('orderPhone');
    const orderInstructionsElement = document.getElementById('orderInstructions');
    const contactDriverBtn = document.getElementById('contactDriverBtn');

    onValue(orderRef, (snapshot) => {
      const order = snapshot.val();
      if (order) {
        orderIdElement.textContent = orderId;
        orderTotalElement.textContent = order.total;
        orderPaymentMethodElement.textContent = order.paymentMethod;
        orderAddressElement.textContent = order.address;
        orderPhoneElement.textContent = order.phone;
        orderInstructionsElement.textContent = order.instructions || "No special instructions.";

        orderItemsElement.innerHTML = '';
        if (Array.isArray(order.cart)) {
          order.cart.forEach(item => {
            const li = document.createElement('li');
            li.textContent = `${item.name} x${item.quantity} - R${(item.price * item.quantity).toFixed(2)}`;
            orderItemsElement.appendChild(li);
          });
        }

        orderStatusElement.textContent = `Status: ${order.status}`;

        if (order.status === 'Out for Delivery') {
          contactDriverBtn.classList.remove('hidden');
        }
      } else {
        orderStatusElement.textContent = 'Order not found.';
      }
    });
  </script>
</body>
</html>

